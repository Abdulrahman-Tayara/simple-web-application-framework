<!DOCTYPE html>
<Html id="1072200404">
<body id="1349040186">
<div id="456941913">{{upper(lower(var1,var1),lower(var1),'s') > 2}}</div>
<div id="1008531105">
    <div id="731819592"></div>
    <div id="1715026706"></div>
    <div id="1409897457"></div>
</div>
<script>

    function forthyear() {
        this.var1 = "initial value";
        this.var2 = false;
        this.var3 = true;
    }

    var forthyear = new forthyear();
</script>
</script>

<script>
    let inits = [];
    let changes = [];
    let forRenders = [];
    let defaultInnerHTML = {};
    let cpShowIdBindings = {};
    let cpHideIdBindings = {};
    let cpIfConditionalBindings = [];
    let cpSwitchBindings = [];
    let deletedNodes = [];
    let repeatedNodes = [];
</script>

<script>
    function assigneInitalVariables(id, variableName) {
        document.getElementById(id).value = forthyear[variableName];
    }

    function changeValue(id, variableName) {
        forthyear[variableName] = document.getElementById(id).value;
    }

    function bindCpModelToVar(id, variableName) {
        inits.push(() => {
            assigneInitalVariables(id, variableName);
        });
        document.getElementById(id).addEventListener("input", (event) => {
            changes.push(() => {
                changeValue(id, variableName);
            });
        });
    }

    function bindVariableUseageWithVariable(id, variableName) {
        let text = document.getElementById(id).innerHTML;
        if (defaultInnerHTML[variableName] === undefined) {
            defaultInnerHTML[variableName] = [];
            defaultInnerHTML[variableName].push({id: id, text: text});
        } else {
            defaultInnerHTML[variableName].push({id: id, text: text});
        }
    }

    function replaceAllVariableUsages() {
        Object.keys(defaultInnerHTML).forEach(key => {
            for (let index = 0; index < defaultInnerHTML[key].length; index++) {
                let obj = defaultInnerHTML[key][index];
                let newText = obj.text.replace("{{" + key + "}}", forthyear[key]);
                document.getElementById(obj.id).innerHTML = newText;
            }
        });
    }

    function addCpShowIdBinding(id, variableName) {
        if (cpShowIdBindings[variableName] === undefined) {
            cpShowIdBindings[variableName] = [];
            cpShowIdBindings[variableName].push(id);
        } else {
            cpShowIdBindings[variableName].push(id);
        }
    }

    function renderCpShowConditionally(id, variableName) {
        Object.keys(cpShowIdBindings).forEach(variableName => {
            for (let index = 0; index < cpShowIdBindings[variableName].length; index++) {
                let id = cpShowIdBindings[variableName][index];
                if (forthyear[variableName] == true) {
                    document.getElementById(id).hidden = false;
                } else {
                    document.getElementById(id).hidden = true;
                }
            }
        });
    }

    function addCpHideIdBinding(id, variableName) {
        if (cpHideIdBindings[variableName] === undefined) {
            cpHideIdBindings[variableName] = [];
            cpHideIdBindings[variableName].push(id);
        } else {
            cpHideIdBindings[variableName].push(id);
        }
    }

    function renderCpHideConditionally(id, variableName) {
        Object.keys(cpHideIdBindings).forEach(variableName => {
            for (let index = 0; index < cpHideIdBindings[variableName].length; index++) {
                let id = cpHideIdBindings[variableName][index];
                if (forthyear[variableName] == true) {
                    document.getElementById(id).hidden = true;
                } else {
                    document.getElementById(id).hidden = false;
                }
            }
        });
    }

    function addCpIfBinding(id, variableName, expectedValue) {
        cpIfConditionalBindings.push({id: id, variableName: variableName, expectedValue: expectedValue});
    }

    function renderCpIfConditionalBindings() {
        for (let index = 0; index < cpIfConditionalBindings.length; index++) {
            let cond = cpIfConditionalBindings[index];
            let doc = document.getElementById(cond.id);
            if (forthyear[cond.variableName] != cond.expectedValue) {
                let rep = document.createElement('div');
                rep.id = cond.id;
                rep.hidden = true;
                doc.after(rep);
                let cloneDoc = doc.cloneNode(true);
                deletedNodes.push(cloneDoc);
                doc.remove();
            }
        }
    }

    function restoreDeleteIfNodes() {
        for (let index = 0; index < deletedNodes.length; index++) {
            let delNode = deletedNodes[index];
            let rep = document.getElementById(delNode.id);
            rep.after(delNode);
            rep.remove();
        }
        deletedNodes = [];
    }
</script>

<script>
    bindCpIf("456941913", "var3 > 2");
    bindVariableUseageWithVariable("456941913", "upper(lower(var1),'s') > 2");
    bindCpSwitch("1008531105", "x", [{"childId": "731819592", "expression": "2"}, {
        "childId": "1715026706",
        "expression": "\u0027s\u0027"
    }, {"childId": "1409897457", "expression": "true"}]);

    function render() {
        setInterval(() => {
            restoreDeleteIfNodes();
            for (var i = 0; i < changes.length; i++) {
                changes[i]();
            }
            changes = [];
            for (let index = 0; index < inits.length; index++) {
                inits[index]();
            }
            for (let index = 0; index < forRenders.length; index++) {
                forRenders[index]();
            }
            replaceAllVariableUsages();
            renderCpShowConditionally();
            renderCpHideConditionally();
            renderCpIfConditionalBindings();
        }, 16);
    }

    render();
</script>
</body>
</Html>